<html>

<head>
	<title>Code Generator</title>
	<link rel=StyleSheet href="./stylesheet.css" type="text/css" media=screen>
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
</head>

<body onload="generateCodeOnload()">
	<script type="text/javascript">
		var textGlobal = "";
		var i = 0;
		var j = 0;
		function generateCodeOnload() {
			document.getElementById("causeDiv").style.display = "none";
			document.getElementById("effectDiv").style.display = "none";
			document.getElementById("previewAction").style.display = "none";
			document.getElementById("effects").value = "-1";
			document.getElementById("cause").value = "-1";
			document.getElementById("watchReg").value = "";
			document.getElementById("label").value = "";
			document.getElementById("targetAddr").value = "";
			document.getElementById("operation").value = "-1";
			document.getElementById("bitNumber").value = "";
			document.getElementById("targetEffectAddr").value = "";
			document.getElementById("operationEffect").value = "-1";
			document.getElementById("bitNumberEffect").value = "";
			document.getElementById("inputFileNameToSaveAs").value = "";
		}
		function showCauseDiv() {
			//alert("inside cause div onchange");
			if (document.getElementById("cause").value == 'yes') {
				document.getElementById("causeDiv").style.display = "block";
			}
			else if (document.getElementById("cause").value == 'no') {
				document.getElementById("causeDiv").style.display = "none";
			}
		}
		function showEffectDiv() {
			//alert("inside effect div onchange");
			if (document.getElementById("effects").value == 'yes') {
				document.getElementById("effectDiv").style.display = "block";
			}
			else if (document.getElementById("effects").value == 'no') {
				document.getElementById("effectDiv").style.display = "none";
			}
		}
		function previewAct() {
			// alert("inside show preview");
			document.getElementById("previewAction").style.display = "block";
			var textToSave = document.getElementById("prevAction").value;
			var watchReg = document.getElementById("watchReg").value;
			var label = document.getElementById("label").value;
			var cause = document.getElementById("cause").value;
			var targetAddr = document.getElementById("targetAddr").value;

			var operation = document.getElementById("operation").value;
			var bitNumber = document.getElementById("bitNumber").value;

			var effects = document.getElementById("effects").value;

			var targetEffectAddr = document.getElementById("targetEffectAddr").value;
			var operationEffect = document.getElementById("operationEffect").value;

			var bitNumberEffect = document.getElementById("bitNumberEffect").value;
			if (cause == 'yes' && effects == 'yes') {
				if (textGlobal != "") {
					textToSave = textGlobal + "\nCAUSE_EFFECT{\nWATCH=[REG(" + watchReg + ")] \nLABEL=[" + label + "] \nCAUSE: TARGET=[REG(" + targetAddr + ")] OP=[" + operation + "] BIT=[" + bitNumber + "] \nEFFECT: TARGET=[REG(" + targetEffectAddr + ")] OP=[" + operationEffect + "] BIT=[" + bitNumberEffect + "]}";
					textGlobal = textToSave;
				}
				else {
					textToSave = "\CAUSE_EFFECT{\nWATCH=[REG(" + watchReg + ")] \nLABEL=[" + label + "] \nCAUSE: TARGET=[REG(" + targetAddr + ")] OP=[" + operation + "] BIT=[" + bitNumber + "] \nEFFECT: TARGET=[REG(" + targetEffectAddr + ")] OP=[" + operationEffect + "] BIT=[" + bitNumberEffect + "]}";
					textGlobal = textToSave;
				}
			}
			else if (cause == 'yes' && effects == 'no') {
				if (textGlobal != "") {
					textToSave = textGlobal + "\nCAUSE_EFFECT{\nWATCH=[REG(" + watchReg + ")] \nLABEL=[" + label + "] \nCAUSE: TARGET=[REG(" + targetAddr + ")] OP=[" + operation + "] BIT=[" + bitNumber + "]}";
					textGlobal = textToSave;
				}
				else {
					textToSave = "\CAUSE_EFFECT{\nWATCH=[REG(" + watchReg + ")] \nLABEL=[" + label + "]nCAUSE: TARGET=[REG(" + targetAddr + ")] OP=[" + operation + "] BIT=[" + bitNumber + "]}";
					textGlobal = textToSave;
				}
			}
			document.getElementById("prevAction").value = textToSave;
		}
		function hidePreviewAct() {
			// alert("inside hide preview");
			document.getElementById("previewAction").style.display = "none";
		}
		function saveTextAsFile() {
			var causeData = [];


			var textToSave = document.getElementById("prevAction").value;
			var watchReg = document.getElementById("watchReg").value;
			var label = document.getElementById("label").value;
			var cause = document.getElementById("cause").value;
			//var targetAddr = document.getElementById("targetAddr").value;
			var operation = document.getElementById("operation").value;
			//var bitNumber = document.getElementById("bitNumber").value;

			var effects = document.getElementById("effects").value;
			var targetEffectAddr = document.getElementById("targetEffectAddr").value;
			var operationEffect = document.getElementById("operationEffect").value;
			var bitNumberEffect = document.getElementById("bitNumberEffect").value;

			var causeSection = $('#causeDiv').find('.dropdown-parent');
			causeSection.each(function(_, el) {
				causeData.push({
					targetAddr: $(el).find('.targetAddr').val(),
					dropdown: $(el).find('.dropdown').val(),
					bitNumber: $(el).find('.bitNumber').val(),
				})
				//console.log($(el).find('.targetAddr').val())
			})
			console.log(causeData)
			return;

			if (cause != '-1' && cause == 'yes') {
				//put validation alerts here
			}

			if (effects != '-1' && effects == 'yes') {
				//put validation alerts here
			}

			if (cause == 'yes' && effects == 'yes') {
				if (textGlobal != "") {
					textToSave = textGlobal + "\nCAUSE_EFFECT{\nWATCH=[REG(" + watchReg + ")] \nLABEL=[" + label + "] \nCAUSE: TARGET=[REG(" + targetAddr + ")] OP=[" + operation + "] BIT=[" + bitNumber + "] \nEFFECT: TARGET=[REG(" + targetEffectAddr + ")] OP=[" + operationEffect + "] BIT=[" + bitNumberEffect + "]}";
					textGlobal = textToSave;
				}
				else {
					textToSave = "CAUSE_EFFECT{\nWATCH=[REG(" + watchReg + ")] \nLABEL=[" + label + "] \nCAUSE: TARGET=[REG(" + targetAddr + ")] OP=[" + operation + "] BIT=[" + bitNumber + "] \nEFFECT: TARGET=[REG(" + targetEffectAddr + ")] OP=[" + operationEffect + "] BIT=[" + bitNumberEffect + "]}";
					textGlobal = textToSave;
				}
			}
			else if (cause == 'yes' && effects == 'no') {
				if (textGlobal != "") {
					
					console.log(causeSection)
					textToSave = textGlobal + "\nCAUSE_EFFECT{\nWATCH=[REG(" + watchReg + ")] \nLABEL=[" + label + "] \nCAUSE: TARGET=[REG(" + targetAddr + ")] OP=[" + operation + "] BIT=[" + bitNumber + "]}";
					textGlobal = textToSave;
				}
				else {
					alert('no value');
					textToSave = "CAUSE_EFFECT{\nWATCH=[REG(" + watchReg + ")] \nLABEL=[" + label + "]nCAUSE: TARGET=[REG(" + targetAddr + ")] OP=[" + operation + "] BIT=[" + bitNumber + "]}";
					textGlobal = textToSave;
				}
			}
			textToSave = textToSave.replace(/\n/g, "\r\n");
			var textToSaveAsBlob = new Blob([textToSave], { type: "text/plain" });
			var textToSaveAsURL = window.URL.createObjectURL(textToSaveAsBlob);
			var fileNameToSaveAs = document.getElementById("inputFileNameToSaveAs").value;

			var downloadLink = document.createElement("a");
			downloadLink.download = fileNameToSaveAs;
			downloadLink.innerHTML = "Download File";
			downloadLink.href = textToSaveAsURL;
			downloadLink.onclick = destroyClickedElement;
			downloadLink.style.display = "none";
			document.body.appendChild(downloadLink);
			downloadLink.click();
		}
		function destroyClickedElement(event) {
			document.body.removeChild(event.target);
		}
		function resetAllFields() {
			generateCodeOnload();
		}
		function resetSelectFields() {
			document.getElementById("watchReg").value = "";
			document.getElementById("label").value = "";
			document.getElementById("cause").value = "-1";
			document.getElementById("targetAddr").value = "";

			document.getElementById("operation").value = "-1";
			document.getElementById("bitNumber").value = "";

			document.getElementById("effects").value = "-1";

			document.getElementById("targetEffectAddr").value = "";
			document.getElementById("operationEffect").value = "-1";

			document.getElementById("bitNumberEffect").value = "";

			document.getElementById("causeDiv").style.display = "none";
			document.getElementById("effectDiv").style.display = "none";

		}
		function addCause(that) {
			var lastCount = $(that).parent().parent().find('.dropdown-parent').last().data().count;
			//console.log(lastCount);
			//console.log($(that).data().count);
			addDiv('causeDiv', `<label>Target Address</label><input type = "text" class ="targetAddr" style="margin-left:5px"/><div class="dropdown" style="margin-left:3px">Operation: <select id="operation"><option value="-1">Select One</option><option value="AND">AND</option><option value="OR">OR</option><option value="EQUALTO">EQUALTO</option><option value="BIT_ON">BIT_ON</option><option value="ALLONES">ALLONES</option><option value="ALLZEROS">ALLZEROS</option></select></div><label style="margin-left:2px">BIT Number</label><input type = "text" class ="bitNumber" style="margin-left:6px"/><input type="button" onclick="addCause(this)" value="Add Another Cause" style="margin-left:5px"/><input type="button" onclick="removeCause()" value="Remove Cause" style="margin-left:6px"/>`, {
				'class': 'dropdown-parent',
				'data-attr': 'attr',
				'data-count': lastCount+1
			});
			//$(this).prev('li').prop('id', 'newId');	
		}
		function addEffect() {
			j++;
			addDiv('effectDiv', '<div id="effectDiv" class="dropdown-parent"><label>Target Address</label><input type = "text" id ="targetEffectAddr" style="margin-left:5px"/><div class="dropdown" style="margin-left:3px">Operation: <select id="operationEffect"><option value="-1">Select One</option><option value="AND">AND</option><option value="OR">OR</option><option value="EQUALTO">EQUALTO</option><option value="BIT_ON">BIT_ON</option><option value="ALLONES">ALLONES</option><option value="ALLZEROS">ALLZEROS</option></select></div><label style="margin-left:2px">BIT Number</label><input type = "text" id ="bitNumberEffect" style="margin-left:6px"/><input type="button" onclick="addEffect()" value="Add Another Effect" style="margin-left:5px"/><input type="button" onclick="removeEffect()" value="Remove Effect" style="margin-left:6px"/></div>', {
				'class': 'dropdown-parent',
				'data-attr': 'attr'
			});
		}
		function removeCause() {
			$(this).closest("#causeDiv").remove();
		}
		function removeEffect() {
			$(this).closest("#effectDiv").remove();
		}
		function addDiv(parent_div, content, attrs) {
			var div = document.createElement('div');
			var parent = document.getElementById(parent_div);

			for (var key in attrs) {
				if (attrs.hasOwnProperty(key)) {
					div.setAttribute(key, attrs[key]);
				}
			}
			div.innerHTML = content;
			if (parent) {
				parent.appendChild(div);
			}
		}
	</script>

	<div id="navigation">
		<center>
			<h1>Dynamic Code Generator</h1>
		</center>
		<div class="dropdown-parent">
			<label>Watch Reg</label>
			<input type="text" id="watchReg" />
			<label style="margin-left:275px">Label</label>
			<input type="text" id="label" />
		</div>
		<div class="dropdown" style="margin-left:-15px">
			Do you want to select the Causes:
			<select id="cause" onchange="showCauseDiv()">
				<option value="-1">Select One</option>
				<option value="yes">Yes</option>
				<option value="no">No</option>
			</select>
		</div>
		<div id="causeDiv">
			<div class="dropdown-parent" data-count=1>
				<label>Target Address</label>
				<input type="text" class="targetAddr" />
				<div class="dropdown">
					Operation:
					<select id="operation">
						<option value="-1">Select One</option>
						<option value="AND">AND</option>
						<option value="OR">OR</option>
						<option value="EQUALTO">EQUALTO</option>
						<option value="BIT_ON">BIT_ON</option>
						<option value="ALLONES">ALLONES</option>
						<option value="ALLZEROS">ALLZEROS</option>
					</select>
				</div>
				<label>BIT Number</label>
				<input type="text" class="bitNumber" />
				<input data-count="1" type="button" onclick="addCause(this)" value="Add Another Cause" />
			</div>
		</div>

		<div style="margin-left:1px">
			Do you want to select the Effects:
			<select id="effects" onchange="showEffectDiv()">
				<option value="-1">Select One</option>
				<option value="yes">Yes</option>
				<option value="no">No</option>
			</select>
		</div>
		<div id="effectDiv">
			<div class="dropdown-parent">
				<label>Target Address</label>
				<input type="text" id="targetEffectAddr" />
				<div class="dropdown">
					Operation:
					<select id="operationEffect">
						<option value="-1">Select One</option>
						<option value="AND">AND</option>
						<option value="OR">OR</option>
						<option value="EQUALTO">EQUALTO</option>
						<option value="BIT_ON">BIT_ON</option>
						<option value="ALLONES">ALLONES</option>
						<option value="ALLZEROS">ALLZEROS</option>
					</select>
				</div>
				<label>BIT Number</label>
				<input type="text" id="bitNumberEffect" />
				<input type="button" onclick="addEffect()" value="Add Another Effect" />
			</div>
		</div>

		<div id="previewAction">
			<textarea id="prevAction" rows="4" cols="50" readonly style="margin-left: 326px;margin-top: 29px;"></textarea>
		</div>
		<br>
		<br>
		<div>
			<tr class="dropdown-parent">
				<td>
					<button onclick="previewAct()" style="margin-left:390px">Preview Action</button>
				</td>
				<td>
					<button onclick="hidePreviewAct()">Hide Preview</button>
				</td>
			</tr>
			<br>
			<br>
		</div>
		<div style="margin-left:262px">
			<tr>
				<td>Filename to Save As:</td>
				<td>
					<input id="inputFileNameToSaveAs"></input>
				</td>
				<td>
					<button onclick="saveTextAsFile()">Generate Action File</button>
				</td>
			</tr>
		</div>
		<div style="margin-left:-89px">
			<br>
			<br>
			<button onclick="resetAllFields()" style="margin-left:534px">Reset</button>
			<button onclick="resetSelectFields()">Add More</button>
		</div>
	</div>
</body>

</html>
<html>

<head>
	<title>Code Generator</title>
	<link rel=StyleSheet href="./stylesheet.css" type="text/css" media=screen>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
</head>

<body onload="generateCodeOnload()">
	<script type="text/javascript">
		var textGlobal = "";
		var i = 0;
		var j = 0;
		function generateCodeOnload() {
			document.getElementById("causeDiv").style.display = "none";
			document.getElementById("effectDiv").style.display = "none";
			document.getElementById("previewAction").style.display = "none";
			document.getElementById("effects").value = "-1";
			document.getElementById("cause").value = "-1";
			document.getElementById("watchReg").value = "";
			document.getElementById("label").value = "";
			document.getElementsByName("targetAddr").value = "";
			document.getElementById("operation").value = "-1";
			document.getElementsByName("bitNumber").value = "";
			document.getElementsByName("targetEffectAddr").value = "";
			document.getElementById("operationEffect").value = "-1";
			document.getElementsByName("bitNumberEffect").value = "";
			document.getElementById("inputFileNameToSaveAs").value = "";

			$(".bitNumber").hide();
			$(".bitNumCause").hide();
			$(".box1").hide();
			$(".box1Cause").hide();
			$(".box2").hide();
			$(".box2Cause").hide();

			$(".bitNumEffect").hide();
			$(".bitNumberEffect").hide();
			$(".box1Eff").hide();
			$(".box1effect").hide();
			$(".box2Eff").hide();
			$(".box2effect").hide();
			
			$('#operation').prop('selectedIndex',0);
			$('#operationEffect').prop('selectedIndex',0);
			
			$('.dropdown-parent-cause input[type="text"]').val('');
			$('.dropdown-parent-effect input[type="text"]').val('');
		}
		function showCauseDiv() {
			//alert("inside cause div onchange");
			if (document.getElementById("cause").value == 'yes') {
				document.getElementById("causeDiv").style.display = "block";
			}
			else if (document.getElementById("cause").value == 'no') {
				document.getElementById("causeDiv").style.display = "none";
			}
		}
		function showEffectDiv() {
			//alert("inside effect div onchange");
			if (document.getElementById("effects").value == 'yes') {
				document.getElementById("effectDiv").style.display = "block";
			}
			else if (document.getElementById("effects").value == 'no') {
				document.getElementById("effectDiv").style.display = "none";
			}
		}
		function previewAct() {
			// alert("inside show preview");
			document.getElementById("previewAction").style.display = "block";
			var causeText="";
			var effectText="";
			var textToSave = document.getElementById("prevAction").value;
			var watchReg = document.getElementById("watchReg").value;
			var label = document.getElementById("label").value;
			var cause = document.getElementById("cause").value;
			var effects = document.getElementById("effects").value;

			// Get Cause Values
			var causeDiv_values = '';
				$('.dropdown-parent-cause').each(function() {
					//get values
					var text1 = $(this).find('.targetAddr').val();
					var text2 = $(this).find('#operation').val();
					if(text2=='AND' || text2=='OR'){
						var text3 = $(this).find('.bitNumber').val();
						causeDiv_values += '|'+ text1 +','+ text2 +','+ text3;
					}else{
						var text3 = $(this).find('.box1').val();
						var text4 = $(this).find('.box2').val();
						causeDiv_values += '|'+ text1 +','+ text2 +','+ text3+','+text4;
					}
				});
			var count=(causeDiv_values.split("|").length - 1);
			var cause_arr;
			cause_arr=causeDiv_values.split("|");
			for(i=1;i<=count;i++){
				var cause_arr_val=cause_arr[i].split(",");
				var addr=cause_arr_val[0];
				var operation=cause_arr_val[1];
				if(operation=='AND' || operation=='OR'){
					var bitNumber=cause_arr_val[2];
				}
				else{
					var box1=cause_arr_val[2];
					var box2=cause_arr_val[3];
				}
				if(causeText==""){
					if(operation=='AND' || operation=='OR'){
						causeText="CAUSE_EFFECT{\nWATCH=[REG(" + watchReg + ")] \nLABEL=[" + label + "] \nCAUSE: TARGET=[REG(" + addr + ")] OP=[" + operation + "] BIT=[" + bitNumber + "]";
					}else{
						causeText="CAUSE_EFFECT{\nWATCH=[REG(" + watchReg + ")] \nLABEL=[" + label + "] \nCAUSE: TARGET=[REG(" + addr + ")] OP=[" + operation + "] BOX1=[" + box1 + "] BOX2=[" + box2 + "]";
					}
				}else{
					if(operation=='AND' || operation=='OR'){
						causeText=causeText+"\nCAUSE: TARGET=[REG(" + addr + ")] OP=[" + operation + "] BIT=[" + bitNumber + "]";
					}else{
						causeText=causeText+"\nCAUSE: TARGET=[REG(" + addr + ")] OP=[" + operation + "] BOX1=[" + box1 + "] BOX2=[" + box2 + "]";
					}					
				}
			}
			if (cause == 'yes' && effects == 'yes') {
				// Get Effect Div Values
				var effectDiv_values = '';
					$('.dropdown-parent-effect').each(function() {
						//get values
						var text1 = $(this).find('.targetEffectAddr').val();
						var text2 = $(this).find('#operationEffect').val();
						if(text2=='AND' || text2=='OR'){
							var text3 = $(this).find('.bitNumberEffect').val();
							effectDiv_values += '|'+ text1 +','+ text2 +','+ text3;
						}else{
							var text3 = $(this).find('.box1effect').val();
							var text4 = $(this).find('.box2effect').val();
							effectDiv_values += '|'+ text1 +','+ text2 +','+ text3+','+text4;
						}						
					});
				var count_eff=(effectDiv_values.split("|").length - 1);
				var effect_arr;
				effect_arr=effectDiv_values.split("|");
				for(i=1;i<=count_eff;i++){
					var effect_arr_val=effect_arr[i].split(",");
					var addrEff=effect_arr_val[0];
					var operationEff=effect_arr_val[1];
					if(operationEff=='AND' || operationEff=='OR'){
						var bitNumberEff=effect_arr_val[2];
					}else{
						var box1eff=effect_arr_val[2];
						var box2eff=effect_arr_val[3];
					}					
					if(effectText==""){
						if(operationEff=='AND' || operationEff=='OR'){
							effectText="\nEFFECT: TARGET=[REG(" + addrEff + ")] OP=[" + operationEff + "] BIT=[" + bitNumberEff + "]";
						}else{
							effectText="\nEFFECT: TARGET=[REG(" + addrEff + ")] OP=[" + operationEff + "] BOX1=[" + box1eff + "] BOX2=[" + box2eff + "]";
						}						
					}
					else{
						if(operationEff=='AND' || operationEff=='OR'){
							effectText=effectText+"\nEFFECT: TARGET=[REG(" + addrEff + ")] OP=[" + operationEff + "] BIT=[" + bitNumberEff + "]";
					}else{
						   effectText=effectText+"\nEFFECT: TARGET=[REG(" + addrEff + ")] OP=[" + operationEff + "] BOX1=[" + box1eff + "] BOX2=[" + box2eff + "]";
					    }						
				    }
				}
				effectText=effectText+"}";
				textToSave=causeText+effectText;
			}
			else if (cause == 'yes' && effects == 'no') {
				causeText=causeText+"}";
				textToSave=causeText;
			}
			textGlobal=textToSave;
			document.getElementById("prevAction").value = textToSave;
		}
		function hidePreviewAct() {
			document.getElementById("previewAction").style.display = "none";
		}

		function saveTextAsFile() {
			var textToSave = textGlobal;			
			textToSave = textToSave.replace(/\n/g, "\r\n");
			var textToSaveAsBlob = new Blob([textToSave], { type: "text/plain" });
			var textToSaveAsURL = window.URL.createObjectURL(textToSaveAsBlob);
			var fileNameToSaveAs = document.getElementById("inputFileNameToSaveAs").value;

			var downloadLink = document.createElement("a");
			downloadLink.download = fileNameToSaveAs;
			downloadLink.innerHTML = "Download File";
			downloadLink.href = textToSaveAsURL;
			downloadLink.onclick = destroyClickedElement;
			downloadLink.style.display = "none";
			document.body.appendChild(downloadLink);
			downloadLink.click();
			textGlobal="";
		}
		function destroyClickedElement(event) {
			document.body.removeChild(event.target);
		}
		function resetAllFields() {
			generateCodeOnload();
		}

		function addCause(that) {
			var lastCount = $(that).parent().parent().find('.dropdown-parent-cause').last().data().count;
			addDiv('causeDiv', `<label>Target Address</label><input type = "text" class ="targetAddr" style="margin-left:5px" onblur="isValidhexTargetAddressCause(this)"/><div class="dropdown-cause-operation" style="margin-left:3px">Operation: <select id="operation" onchange="showProperTextBox(this)"><option value="-1">Select One</option><option value="AND">AND</option><option value="OR">OR</option><option value="EQUALTO">EQUALTO</option><option value="BIT_ON">BIT_ON</option><option value="ALLONES">ALLONES</option><option value="ALLZEROS">ALLZEROS</option></select></div><label style="margin-left:2px" class="bitNumCause">BIT Number</label><input type = "text" class ="bitNumber" style="margin-left:6px" onkeypress="return isNumber(event)"/><label style="margin-left:4px" class="box1Cause">Box 1</label><input type = "text" class ="box1" style="margin-left:4px"/><label style="margin-left:4px" class="box2Cause">Box 2</label><input type = "text" class ="box2" style="margin-left:5px"/><input type="button" onclick="addCause(this)" value="Add" style="margin-left:4px"/><input type="button" onclick="removeCause(this)" value="Remove" style="margin-left:6px"/>`, {
				'class': 'dropdown-parent-cause',
				'data-attr': 'attr',
				'data-count': lastCount+1,
				'id':'causeDiv'+(lastCount+1)
			});
			var divid='causeDiv'+(lastCount+1);
			$("#"+divid+" .bitNumber").hide();
			$("#"+divid+" .bitNumCause").hide();
			$("#"+divid+" .box1").hide();
			$("#"+divid+" .box1Cause").hide();
			$("#"+divid+" .box2").hide();
			$("#"+divid+" .box2Cause").hide();
		}
		function addEffect(that) {
			var lastCount = $(that).parent().parent().find('.dropdown-parent-effect').last().data().count;
			addDiv('effectDiv', `<label>Target Address</label><input type = "text" class ="targetEffectAddr" style="margin-left:5px" onblur="isValidhexTargetAddressEffect(this)"/><div class="dropdown-effect-operation" style="margin-left:3px">Operation: <select id="operationEffect" onchange="showProperTextBoxEffect(this)"><option value="-1">Select One</option><option value="AND">AND</option><option value="OR">OR</option><option value="EQUALTO">EQUALTO</option><option value="BIT_ON">BIT_ON</option><option value="ALLONES">ALLONES</option><option value="ALLZEROS">ALLZEROS</option></select></div><label style="margin-left:2px" class="bitNumEffect">BIT Number</label><input type = "text" class ="bitNumberEffect" style="margin-left:6px" onkeypress="return isNumber(event)"/><label style="margin-left:4px" class="box1Eff">Box 1</label><input type = "text" class ="box1effect" style="margin-left:4px"/><label style="margin-left:4px" class="box2Eff">Box 2</label><input type = "text" class ="box2effect" style="margin-left:5px"/><input type="button" onclick="addEffect(this)" value="Add" style="margin-left:4px"/><input type="button" onclick="removeEffect(this)" value="Remove" style="margin-left:6px"/>`, {
				'class': 'dropdown-parent-effect',
				'data-attr': 'attr',
				'data-count': lastCount+1,
				'id':'effectDiv'+(lastCount+1)
			});
			var divid='effectDiv'+(lastCount+1);
			$("#"+divid+" .bitNumEffect").hide();
			$("#"+divid+" .bitNumberEffect").hide();
			$("#"+divid+" .box1Eff").hide();
			$("#"+divid+" .box1effect").hide();
			$("#"+divid+" .box2Eff").hide();
			$("#"+divid+" .box2effect").hide();
		}
		function removeCause(that) {
			$(that).closest('.dropdown-parent-cause').remove();
		}
		function removeEffect(that) {
			$(that).closest('.dropdown-parent-effect').remove();
		}
		function addDiv(parent_div, content, attrs) {
			var div = document.createElement('div');
			var parent = document.getElementById(parent_div);

			for (var key in attrs) {
				if (attrs.hasOwnProperty(key)) {
					div.setAttribute(key, attrs[key]);
				}
			}
			div.innerHTML = content;
			if (parent) {
				parent.appendChild(div);
			}
		}

		function showProperTextBox(that){
			var divid=$(that).parents(':eq(1)').attr("id");
			var dd_val=$(that).val();

			if(dd_val=='AND'|| dd_val=='OR'){
				$("#"+divid+" .bitNumber").show();
				$("#"+divid+" .bitNumCause").show();
				$("#"+divid+" .box1").hide();
				$("#"+divid+" .box1Cause").hide();
				$("#"+divid+" .box2").hide();
				$("#"+divid+" .box2Cause").hide();
			}else if(dd_val!='AND' && dd_val!='OR' && dd_val!='-1'){
				$("#"+divid+" .bitNumber").hide();
				$("#"+divid+" .bitNumCause").hide();
				$("#"+divid+" .box1").show();
				$("#"+divid+" .box1Cause").show();
				$("#"+divid+" .box2").show();
				$("#"+divid+" .box2Cause").show();
			}else if(dd_val=='-1'){
				$("#"+divid+" .bitNumber").hide();
				$("#"+divid+" .bitNumCause").hide();
				$("#"+divid+" .box1").hide();
				$("#"+divid+" .box1Cause").hide();
				$("#"+divid+" .box2").hide();
				$("#"+divid+" .box2Cause").hide();
			}
		}
		function showProperTextBoxEffect(that){
			var divid=$(that).parents(':eq(1)').attr("id");
			var dd_val=$(that).val();

			if(dd_val=='AND'|| dd_val=='OR'){
				$("#"+divid+" .bitNumEffect").show();
				$("#"+divid+" .bitNumberEffect").show();
				$("#"+divid+" .box1Eff").hide();
				$("#"+divid+" .box1effect").hide();
				$("#"+divid+" .box2Eff").hide();
				$("#"+divid+" .box2effect").hide();
			}else if(dd_val!='AND' && dd_val!='OR' && dd_val!='-1'){
				$("#"+divid+" .bitNumEffect").hide();
				$("#"+divid+" .bitNumberEffect").hide();
				$("#"+divid+" .box1Eff").show();
				$("#"+divid+" .box1effect").show();
				$("#"+divid+" .box2Eff").show();
				$("#"+divid+" .box2effect").show();
			}else if(dd_val=='-1'){
				$("#"+divid+" .bitNumEffect").hide();
				$("#"+divid+" .bitNumberEffect").hide();
				$("#"+divid+" .box1Eff").hide();
				$("#"+divid+" .box1effect").hide();
				$("#"+divid+" .box2Eff").hide();
				$("#"+divid+" .box2effect").hide();
			}
		}
		//To test Hex Values in Watch Reg
		function isValidhex(ele)
		{
			var regExp = new RegExp(/^0x[0-9A-F]{1,4}$/i);
			if (!regExp.test(ele.value)){
				alert("Please enter valid value in Watch Reg");
			}
		}
		//To test Hex Values in Target Address in Cause
		function isValidhexTargetAddressCause(ele)
		{
			var regExp = new RegExp(/^0x[0-9A-F]{1,4}$/i);
			if (!regExp.test(ele.value)){
				alert("Please enter valid value in Target Address in Cause");
			}
		}
		//To test Hex Values in Target Address in Effect
		function isValidhexTargetAddressEffect(ele)
		{
			var regExp = new RegExp(/^0x[0-9A-F]{1,4}$/i);
			if (!regExp.test(ele.value)){
				alert("Please enter valid value in Target Address in Effect");
			}
		}
		function isValidBinaryNumberCause(ele)
		{
			var regExp = new RegExp('^[0-9]{1,10}$');
			if (!regExp.test(ele.value)){
				alert("Please enter valid BIT Number in Cause");
			}
		}
		function isValidBinaryNumberEffect(ele)
		{
			var regExp = new RegExp('^[0-9]{1,10}$');
			if (!regExp.test(ele.value)){
				alert("Please enter valid BIT Number in Effect");
			}
		}
		function isNumber(evt) {
			evt = (evt) ? evt : window.event;
			var charCode = (evt.which) ? evt.which : evt.keyCode;
			if (charCode > 31 && (charCode < 48 || charCode > 57)) {
				return false;
			}
			return true;
		}

	</script>

	<div id="navigation">
		<center>
			<h1>Dynamic Code Generator</h1>
		</center>
		<div class="dropdown-parent">
			<label>Watch Reg</label>
			<input type="text" id="watchReg" onblur="isValidhex(this)"/>
			<label style="margin-left:275px">Label</label>
			<input type="text" id="label" />
		</div>
		<div class="dropdown" style="margin-left:-15px">
			Do you want to select the Causes:
			<select id="cause" onchange="showCauseDiv()">
				<option value="-1">Select One</option>
				<option value="yes">Yes</option>
				<option value="no">No</option>
			</select>
		</div>
		<div id="causeDiv">
			<div class="dropdown-parent-cause" data-count=1 id="causeDiv">
				<label>Target Address</label>
				<input type="text" class="targetAddr" onblur="isValidhexTargetAddressCause(this)"/>
				<div class="dropdown-cause-operation">
					Operation:
					<select id="operation" onchange="showProperTextBox(this)">
						<option value="-1">Select One</option>
						<option value="AND">AND</option>
						<option value="OR">OR</option>
						<option value="EQUALTO">EQUALTO</option>
						<option value="BIT_ON">BIT_ON</option>
						<option value="ALLONES">ALLONES</option>
						<option value="ALLZEROS">ALLZEROS</option>
					</select>
				</div>
				<label class="bitNumCause">BIT Number</label>
				<input type="text" class="bitNumber" onkeypress="return isNumber(event)"/>
				
				<label class="box1Cause">Box 1</label>
				<input type="text" class="box1" />

				<label class="box2Cause">Box 2</label>
				<input type="text" class="box2" />

				<input data-count="1" type="button" onclick="addCause(this)" value="Add" />
			</div>
		</div>

		<div style="margin-left:1px">
			Do you want to select the Effects:
			<select id="effects" onchange="showEffectDiv()">
				<option value="-1">Select One</option>
				<option value="yes">Yes</option>
				<option value="no">No</option>
			</select>
		</div>
		<div id="effectDiv">
			<div class="dropdown-parent-effect" data-count=1 id="effectDiv">
				<label>Target Address</label>
				<input type="text" class="targetEffectAddr" onblur="isValidhexTargetAddressEffect(this)"/>
				<div class="dropdown-effect-operation">
					Operation:
					<select id="operationEffect" onchange="showProperTextBoxEffect(this)">
						<option value="-1">Select One</option>
						<option value="AND">AND</option>
						<option value="OR">OR</option>
						<option value="EQUALTO">EQUALTO</option>
						<option value="BIT_ON">BIT_ON</option>
						<option value="ALLONES">ALLONES</option>
						<option value="ALLZEROS">ALLZEROS</option>
					</select>
				</div>
				<label class="bitNumEffect">BIT Number</label>
				<input type="text" class="bitNumberEffect" onkeypress="return isNumber(event)"/>
				
				<label class="box1Eff">Box 1</label>
				<input type="text" class="box1effect" />

				<label class="box2Eff">Box 2</label>
				<input type="text" class="box2effect" />

				<input type="button" onclick="addEffect(this)" value="Add" />
			</div>
		</div>

		<div id="previewAction">
			<textarea id="prevAction" rows="4" cols="50" readonly style="margin-left: 326px;margin-top: 29px;"></textarea>
		</div>
		<br>
		<br>
		<div>
			<tr class="dropdown-parent">
				<td>
					<button onclick="previewAct()" style="margin-left:390px">Preview Action</button>
				</td>
				<td>
					<button onclick="hidePreviewAct()">Hide Preview</button>
				</td>
			</tr>
			<br>
			<br>
		</div>
		<div style="margin-left:262px">
			<tr>
				<td>Filename to Save As:</td>
				<td>
					<input id="inputFileNameToSaveAs"></input>
				</td>
				<td>
					<button onclick="saveTextAsFile()">Generate Action File</button>
				</td>
			</tr>
		</div>
		<div style="margin-left:-89px">
			<br>
			<br>
			<button onclick="resetAllFields()" style="margin-left:534px">Reset</button>
		</div>
	</div>
</body>

</html>